// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Status {
  id   Int    @id @default(autoincrement())
  name String

  created_at DateTime  @default(now())
  updated_at DateTime  @default(now()) @updatedAt
  deleted_at DateTime?

  User            User[]
  ProductCategory Category[]
}

model Family {
  id String @id @default(cuid())

  name     String
  desc     String?
  owner_id String?

  endpoint String?
  token    String?

  created_at DateTime  @default(now())
  updated_at DateTime  @default(now()) @updatedAt
  deleted_at DateTime?
  room       Room[]
  member     User[]
  // owner      User?     @relation(fields: [owner_id], references: [id])
  Device     Device[]
}

model Room {
  id        String  @id @default(cuid())
  name      String
  desc      String?
  family_id String
  img       String?

  created_at DateTime  @default(now())
  updated_at DateTime  @default(now()) @updatedAt
  deleted_at DateTime?

  family Family   @relation(fields: [family_id], references: [id])
  device Device[]
}

model DeviceType {
  id   Int    @id @default(autoincrement())
  name String

  created_at DateTime  @default(now())
  updated_at DateTime  @default(now()) @updatedAt
  deleted_at DateTime?
  Device     Device[]
}

model Device {
  id        String  @id @default(cuid())
  name      String
  desc      String?
  room_id   String?
  family_id String?
  type_id   Int?

  ha_entity_id String?
  ha_name      String?

  created_at DateTime  @default(now())
  updated_at DateTime  @default(now()) @updatedAt
  deleted_at DateTime?

  room   Room?       @relation(fields: [room_id], references: [id])
  family Family?     @relation(fields: [family_id], references: [id])
  type   DeviceType? @relation(fields: [type_id], references: [id])
}

model UserRole {
  id   Int    @id @default(autoincrement())
  name String
  User User[]
}

model User {
  id            String  @id @default(cuid())
  email         String? @unique
  name          String?
  password      String?
  address       String?
  token         String?
  role_id       Int?    @default(3)
  status_id     Int     @default(1)
  family_id     String?
  family_status Int?
  room_access   Json?

  created_at DateTime  @default(now())
  updated_at DateTime  @default(now()) @updatedAt
  deleted_at DateTime?

  role   UserRole? @relation(fields: [role_id], references: [id])
  status Status    @relation(fields: [status_id], references: [id])
  family Family?   @relation(fields: [family_id], references: [id])
}

model Category {
  id        Int     @id @default(autoincrement())
  name      String?
  status_id Int?    @default(1)

  created_at DateTime  @default(now())
  updated_at DateTime  @default(now()) @updatedAt
  deleted_at DateTime?

  status Status? @relation(fields: [status_id], references: [id])
}
